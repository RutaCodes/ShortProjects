*HW9* RUTA BASIJOKAITE*;
PROC IMPORT DATAFILE="/folders/myfolders/HW9/Tree.xlsx" /** Import an XLSX file.  **/
		    OUT=WORK.HW9DATA
		    DBMS=XLSX
		    REPLACE;
		    GETNAMES=YES;
		    SCANTEXT=YES;
RUN;
OPTIONS NOCENTER NODATE PAGENO=1 LS=76 PS=45 NOLABEL;
DATA ALL;
  YMAX=65;
  *X=DBH;
  Y=HT;
  LNX=LOG(DBH);
  LOGISTIC=LOG((YMAX/Y)-1);
  GOMPERTZ=LOG(-LOG(Y/YMAX));
  RICHARDS=LOG(1-(Y/YMAX));
  WEIBULL=LOG(-LOG(1-(Y/YMAX)));
  LUNDQVIST=LOG(-LOG(Y/YMAX));
  SET HW9DATA;
RUN;
PROC SGPLOT DATA=ALL NOAUTOLEGEND;
   SCATTER X=DBH Y=HT;* / MARKERATTRS=(SYMBOL=CIRCLEFILLED COLOR=BLACK); 
   TITLE'Tree total height (HT) against diameter (DBH)';
RUN;  
PROC MEANS N MEAN MEDIAN STD MIN MAX CSS USS MAXDEC=2 DATA=ALL;
   VAR HT DBH;
   TITLE 'DESCRIPTIVE STATISTICS';
RUN;
*====ESTIMATING INITIAL VALUES OF MODEL PARAMETERS====;
PROC REG DATA=ALL;
  MODEL GOMPERTZ = DBH;
  MODEL LUNDQVIST = LNX;
  MODEL LOGISTIC = LNX;
  MODEL RICHARDS = DBH / NOINT;
  MODEL WEIBULL = LNX; 
RUN;  
TITLE'GOMPERTZ FUCTION';
*====DIFFERENT ITERATION METHODS FOR GOMPERTZ=====;
PROC NLIN DATA=ALL LIST;*METHOD=GAUSS MARQUARDT NEWTON;
  PARMS A=65 B=2.7 C=0.03;
  MODEL Y=A*EXP(-B*EXP(-C*DBH));
  OUTPUT OUT=OUT1 P=PREDICT R=RESIDUAL;
RUN;
ODS GRAPHICS ON;
PROC SGPLOT DATA=OUT1;
  SCATTER X=PREDICT Y=RESIDUAL;
  REFLINE 0;
RUN;
PROC SGPLOT DATA=OUT1;
  SCATTER X=DBH Y=PREDICT;
  REFLINE 0;
RUN;
PROC NLIN DATA=ALL METHOD=MARQUARDT;
  PARMS A=65 B=2.7 C=0.03;
  MODEL Y=A*EXP(-B*EXP(-C*DBH));
  OUTPUT OUT=OUT2 P=PREDICT R=RESIDUAL;
RUN;
PROC SGPLOT DATA=OUT2;
  SCATTER X=PREDICT Y=RESIDUAL;
  REFLINE 0;
RUN;
PROC SGPLOT DATA=OUT2;
  SCATTER X=DBH Y=PREDICT;
  REFLINE 0;
RUN;
PROC NLIN DATA=ALL METHOD=NEWTON;
  PARMS A=65 B=2.7 C=0.03;
  MODEL Y=A*EXP(-B*EXP(-C*DBH));
  OUTPUT OUT=OUT3 P=PREDICT R=RESIDUAL;
RUN;
PROC SGPLOT DATA=OUT3;
  SCATTER X=PREDICT Y=RESIDUAL;
  REFLINE 0;
RUN;
PROC SGPLOT DATA=OUT3;
  SCATTER X=DBH Y=PREDICT;
  REFLINE 0;
RUN;
*=====LUNDQVIST FUNCTION;
TITLE'LUNDQVIST FUCTION';
PROC NLIN DATA=ALL LIST;
  *PARMS A=65 B=4 C=0.5;
  PARMS A=120 B=5 C=0.4;
  MODEL Y=A*EXP(-B*DBH**(-C));
  OUTPUT OUT=OUT4 P=PREDICT R=RESIDUAL;
RUN;
PROC SGPLOT DATA=OUT4;
  SCATTER X=PREDICT Y=RESIDUAL;
  REFLINE 0;
RUN;
PROC SGPLOT DATA=OUT4;
  SCATTER X=DBH Y=PREDICT;
  REFLINE 0;
RUN;
*=====MODIFIED LOGISTIC FUNCTION;
TITLE'MODIFIED LOGISTIC FUCTION';
PROC NLIN DATA=ALL LIST;
  *PARMS A=65 B=43.2 C=1;
  PARMS A=60 B=0.01 C=1.0;
  MODEL Y=A/(1+(1/B)*DBH**(-C));
  OUTPUT OUT=OUT5 P=PREDICT R=RESIDUAL;
RUN;
PROC SGPLOT DATA=OUT5;
  SCATTER X=PREDICT Y=RESIDUAL;
  REFLINE 0;
RUN;
PROC SGPLOT DATA=OUT5;
  SCATTER X=DBH Y=PREDICT;
  REFLINE 0;
RUN;
*=====RICHARDS FUNCTION;
TITLE'RICHARDS FUCTION';
PROC NLIN DATA=ALL LIST;
  PARMS A=65 B=0.01 C=1;
  MODEL Y=A*(1-EXP(-B*DBH))**C;
  OUTPUT OUT=OUT6 P=PREDICT R=RESIDUAL;
RUN;
PROC SGPLOT DATA=OUT6;
  SCATTER X=PREDICT Y=RESIDUAL;
  REFLINE 0;
RUN;
PROC SGPLOT DATA=OUT6;
  SCATTER X=DBH Y=PREDICT;
  REFLINE 0;
RUN;
*=====WEIBULL FUNCTION;
TITLE'WEIBULL FUCTION';
PROC NLIN DATA=ALL LIST;
  PARMS A=65 B=0.02 C=0.9;
  MODEL Y=A*(1-EXP(-B*DBH**C));
  OUTPUT OUT=OUT7 P=PREDICT R=RESIDUAL;
RUN;
PROC SGPLOT DATA=OUT7;
  SCATTER X=PREDICT Y=RESIDUAL;
  REFLINE 0;
RUN;
PROC SGPLOT DATA=OUT7;
  SCATTER X=DBH Y=PREDICT;
  REFLINE 0;
RUN;
DATA NEW;
  DO DBH = 0 TO 220 BY 10;
  GOMPERTZ=46.42*EXP(-2.8*EXP(-0.046*DBH));
  LUNDQVIST = 138.6*EXP(-6.95*DBH**(-0.41));
  LOGISTIC = 68.3/(1+(1/.01)*DBH**(-1.18));
  RICHARDS = 54.39*(1-EXP(-0.02*DBH))**1.07;
  WEIBULL = 53.6*(1-EXP(-0.02*DBH**1.06));
  OUTPUT;
  END;
  SET NEW;
RUN;
ODS GRAPHICS OFF;
PROC EXPORT DATA=NEW
            FILE=NEW
            DBMS=CSV REPLACE;
RUN;
%let _DATAOUT_MIME_TYPE=table/csv;
%let _DATAOUT_NAME=Simulation.csv;
